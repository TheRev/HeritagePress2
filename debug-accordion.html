<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Advanced Options Accordion</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .log {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .advanced-search-toggle .button-link {
        text-decoration: none;
        color: #3498db;
        padding: 4px 10px;
        background: #ffffff;
        border: 1px solid #3498db;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      .advanced-search-options {
        padding: 10px;
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }
      .option-row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        width: 100%;
      }
      .option-row label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        color: #2c3e50;
        white-space: nowrap;
        margin: 0;
      }
      .dashicons {
        font-family: "dashicons";
        display: inline-block;
        line-height: 1;
        font-weight: normal;
        font-style: normal;
      }
      .dashicons-arrow-down-alt2:before {
        content: "▼";
      }
      .dashicons-arrow-up-alt2:before {
        content: "▲";
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <h1>Debug Advanced Options Accordion</h1>
    <div id="log" class="log">Console Log:</div>

    <div class="advanced-search-toggle">
      <button type="button" class="button button-link" id="toggle-advanced">
        Advanced Options
        <span class="dashicons dashicons-arrow-down-alt2"></span>
      </button>
    </div>

    <div
      class="advanced-search-options"
      id="advanced-options"
      style="display: none"
    >
      <div class="option-row">
        <label>
          <input type="checkbox" name="exactmatch" value="yes" />
          Exact match only
        </label>
        <label>
          <input type="checkbox" name="living" value="yes" />
          Living people only
        </label>
        <label>
          <input type="checkbox" name="private" value="yes" />
          Private people only
        </label>
      </div>
    </div>

    <script>
      // Enhanced logging function
      function log(message) {
        var timestamp = new Date().toLocaleTimeString();
        var logDiv = document.getElementById("log");
        logDiv.innerHTML += "<br>" + timestamp + ": " + message;
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(timestamp + ": " + message);
      }

      $(document).ready(function () {
        log("Document ready");

        var isToggling = false;
        var clickCount = 0;

        // Single event handler with comprehensive debugging
        $(document).on("click", "#toggle-advanced", function (e) {
          clickCount++;
          log("Click event fired #" + clickCount);
          log("Event type: " + e.type);
          log("Target: " + e.target.tagName);
          log("Current target: " + e.currentTarget.id);
          log("Is toggling: " + isToggling);

          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();

          if (isToggling) {
            log("Already toggling, ignoring call");
            return;
          }
          isToggling = true;

          var $options = $("#advanced-options");
          var $button = $("#toggle-advanced .dashicons");

          log("Options element found: " + $options.length);
          log("Button element found: " + $button.length);
          log("Current display: " + $options.css("display"));
          log("Is visible: " + $options.is(":visible"));

          var isVisible =
            $options.is(":visible") && $options.css("display") !== "none";
          log("Computed visibility: " + isVisible);

          if (isVisible) {
            log("Starting hide animation");
            $options.slideUp(300, function () {
              log("Hide animation complete");
              isToggling = false;
            });
            $button
              .removeClass("dashicons-arrow-up-alt2")
              .addClass("dashicons-arrow-down-alt2");
          } else {
            log("Starting show animation");
            $options.css("display", "flex").slideDown(300, function () {
              log("Show animation complete");
              isToggling = false;
            });
            $button
              .removeClass("dashicons-arrow-down-alt2")
              .addClass("dashicons-arrow-up-alt2");
          }
        });

        // Monitor for any other click events on the button
        $("#toggle-advanced")[0].addEventListener(
          "click",
          function (e) {
            log("Native click event detected on button");
          },
          true
        );

        // Monitor for any events on the document
        $(document).on("click", function (e) {
          if (
            e.target.id === "toggle-advanced" ||
            $(e.target).closest("#toggle-advanced").length
          ) {
            log("Document click detected on toggle button area");
          }
        });
      });
    </script>
  </body>
</html>
